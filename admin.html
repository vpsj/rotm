<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ROTM Admin Dashboard</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg: #0f1115;
  --panel: #1b1f2a;
  --text: #e8e8e8;
  --muted: #b5b5b5;
  --link: #5aa9ff;
  --gold: #bfa046;
  --silver: #9da3ad;
  --bronze: #a97142;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

h1 {
  text-align: center;
  margin-top: 30px;
}

.sub {
  text-align: center;
  color: var(--muted);
  margin-bottom: 20px;
}

.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

button {
  background: #2a2f3d;
  border: none;
  color: white;
  padding: 10px 14px;
  border-radius: 6px;
  cursor: pointer;
}

button.primary { background: #4c7dff; }
button.danger { background: #d04a3a; }

.panel {
  max-width: 1200px;
  margin: 0 auto 30px;
  background: var(--panel);
  border-radius: 10px;
  padding: 20px;
}

.table-wrap {
  overflow-x: hidden;
}

table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

th, td {
  padding: 12px;
  border-bottom: 1px solid #2b3140;
  vertical-align: top;
}

th {
  color: #dcdcdc;
  font-size: 14px;
  text-align: left;
}

td {
  font-size: 14px;
}

.rank {
  width: 50px;
  text-align: center;
  font-weight: bold;
}

.video {
  width: 40%;
  word-wrap: break-word;
}

.video a {
  color: var(--link);
  text-decoration: none;
}

.video a:hover {
  text-decoration: underline;
}

.num {
  width: 110px;
  text-align: center;
}

.gold { background: rgba(191,160,70,0.35); }
.silver { background: rgba(157,163,173,0.35); }
.bronze { background: rgba(169,113,66,0.35); }

.template {
  white-space: pre-wrap;
  font-family: Consolas, monospace;
  background: #0d0f14;
  padding: 15px;
  border-radius: 6px;
  margin-top: 10px;
}

.copy-btn {
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>ROTM Admin Dashboard</h1>
<div class="sub" id="userInfo"></div>

<div class="controls">
  <button class="primary">Scores</button>
  <button>Detailed Votes & Stats</button>
  <button>Update Videos from links.json</button>
  <button class="danger">Reset All Votes</button>
  <button id="logoutBtn">Logout</button>
</div>

<div class="panel">
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th class="rank">Rank</th>
          <th class="video">Video</th>
          <th class="num">Reddit Upvotes</th>
          <th class="num">Upvote Points</th>
          <th class="num">Rating Points</th>
          <th class="num">Total Score</th>
        </tr>
      </thead>
      <tbody id="scoreBody"></tbody>
    </table>
  </div>
</div>

<div class="panel">
  <h2>Reddit Post Template</h2>
  <div id="template" class="template"></div>
  <button class="copy-btn" onclick="copyTemplate()">Copy Template</button>
</div>

<script>
/* === FIREBASE CONFIG (UNCHANGED) === */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* === AUTH === */
auth.onAuthStateChanged(user => {
  if (!user) location.href = "index.html";
  document.getElementById("userInfo").textContent =
    `Signed in as ${user.email}`;
});

/* === LOAD DATA === */
async function loadScores() {
  const snap = await db.collection("videos").get();
  const videos = snap.docs.map(d => d.data())
    .sort((a,b) => b.totalScore - a.totalScore);

  const tbody = document.getElementById("scoreBody");
  tbody.innerHTML = "";

  videos.forEach((v, i) => {
    const tr = document.createElement("tr");
    if (i === 0) tr.className = "gold";
    if (i === 1) tr.className = "silver";
    if (i === 2) tr.className = "bronze";

    tr.innerHTML = `
      <td class="rank">${i+1}</td>
      <td class="video">
        <a href="${v.redditUrl}" target="_blank">${v.title}</a>
      </td>
      <td class="num">${v.upvotes}</td>
      <td class="num">${v.upvotePoints}</td>
      <td class="num">${v.ratingPoints}</td>
      <td class="num">${v.totalScore}</td>
    `;
    tbody.appendChild(tr);
  });

  buildTemplate(videos);
}

function buildTemplate(videos) {
  const winner = videos[0];
  const runners = videos.slice(1,4);

  let text =
`Title: ✨ RailFan of the Month for [Month][Year] goes to ‘${winner.author}’ for this “${winner.title}”! ✨
As a Reward, they receive a Special Flair + An entry into our ROTM Hall of Fame! [Details in Comments]

---

**Mod Comment:**

Congratulations to u/${winner.author} for becoming the [Month][Year] RailFan of the Month!

If you also wish to see your name immortalized in the [ROTM Hall Of Fame](https://www.reddit.com/r/indianrailways/wiki/hof), get a mention in the sidebar of the subreddit, AND receive a [special flair](https://i.imgur.com/rJCJGMg.png) courtesy of the mods, just go through the [ROTM rules](https://www.reddit.com/r/indianrailways/wiki/rotm) and submit your own beautiful videos of Indian Railways!

Here are some of the other videos loved by both mods and the subreddit that missed out (competition was quite close this time):`;

  runners.forEach(v => {
    text += `

* [${v.title}](${v.redditUrl}) by u/${v.author}`;
  });

  text += `

Congratulations again to the Winner and the runner-ups. The contest will run every month so all the wonderful RailFans of our sub will have plenty of chance to win!

-  r/IndianRailways ModTeam
`;

  document.getElementById("template").textContent = text;
}

function copyTemplate() {
  navigator.clipboard.writeText(
    document.getElementById("template").textContent
  );
}

document.getElementById("logoutBtn").onclick = () => auth.signOut();

loadScores();
</script>

</body>
</html>
